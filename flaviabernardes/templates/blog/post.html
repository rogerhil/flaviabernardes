{% extends 'base.html' %}
{% load staticfiles %}
{% load cropping %}

{% block extrastyle %}
    <link href="{% static 'css/blog.css' %}" rel="stylesheet" />
    <link href="{% static 'css/jquery-te-1.4.0.css' %}" rel="stylesheet" />
    {% block postextrastyle %}
    {% endblock %}
{% endblock %}

{% block title %}{{ post.title }}{% endblock %}
{% block ogtitle %}{{ post.title }}{% endblock %}
{% block ogdescription %}Check out artist Flavia Bernardes' blog post: {{ post.title }}{% endblock %}
{% block ogurl %}{% url 'blog_post_view' post.slug %}{% endblock %}
{% block ogimage %}{% cropped_thumbnail post 'listing' scale=1 %}{% endblock %}

{% block container-top %}
    <div class="parallax banner" bg-size="1920x300"
         style="background-image: url({% cropped_thumbnail post 'banner' scale=1 %});">
        <div class="center-column">
        </div>
        {% block cms_actions %}
            {% if user.is_authenticated and user.is_superuser %}
                <script src="{% static 'js/admin/blog-post.js' %}"></script>
                <p id="preview-actions">
                    <button id="modify-post" class="yellow">
                        MODIFY
                    </button>
                </p>
                <script>
                    $("#modify-post").click(function () {
                        newDraft({{ post.id }});
                    });
                </script>
            {% endif %}
        {% endblock %}
    </div>
{% endblock %}

{% block container %}
    <br>
    <div id="blog">
        <h1 id="title" class="editable">{{ post.title }}</h1>
        <div id="text" class="editable">
            {% autoescape off %}
                {{ post.text }}
            {% endautoescape %}
        </div>
    </div>
    {% comment %}
    <h1>Related Posts</h1>

    <p>0 Thoughts on {{ post }}</p>
    {% endcomment %}
{% endblock %}

{% block newsletter_description %}
    Want more blog posts like this in your inbox? Plus an exclusive artwork wallpaper? Sign up below
{% endblock %}

{% block container-bottom %}
    <div>
        <div class="clear"></div>
        <div id="disqus_thread"></div>
        <div class="hide_disqus_footer">&nbsp;</div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES * * */
            var disqus_shortname = 'flaviabernardesart';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
    <div class="clear"></div>

    <script src="{% static 'js/jquery-te-1.4.0.min.js' %}"></script>
    <script>
    {% comment %}
        $("#title").click(function () {
            if (!$(this).hasClass('editable')) return;
            var value = $(this).html();
            $(this).html('');
            $(this).removeClass('editable');
            $(this).addClass('editing');
            $(this).append($('<input name="title" type="text" value="' + value + '" />'))
            var $save = $('<button>Save</button>')
            $(this).append($save);
            $save.click(function () {
                var value = $('input[name=title]').val();
                $.ajax({
                    url: '{% url 'blog_change_field' blog.slug %}',
                    type: 'post',
                    dataType: 'json',
                    data: {title: value},
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return;
                        }
                        $("#title").html(value);
                        $("#title").removeClass('editing');
                        $("#title").addClass('editable');
                    }
                });
            });
        });

        $("#text").click(function () {
            if (!$(this).hasClass('editable')) return;
            var value = $(this).html();
            $(this).html('');
            $(this).removeClass('editable');
            $(this).addClass('editing');
            $(this).append($('<textarea name="text" value="' + value + '">' + value +  '</textarea>'));
            var $save = $('<button>Save</button>')
            $(this).append($save);
            $("#text textarea[name=text]").jqte();
            $save.click(function () {
                var value = $('textarea[name=text]').val();
                $.ajax({
                    url: '{% url 'blog_change_field' blog.slug %}',
                    type: 'post',
                    dataType: 'json',
                    data: {text: value},
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return;
                        }
                        $("#text").html(value);
                        $("#text").removeClass('editing');
                        $("#text").addClass('editable');
                    }
                });
            });
        });

    {% endcomment %}

    </script>

{% endblock %}