{% load staticfiles %}
{% load cropping %}

<html>
    <head>
        <!-- jQuery library (served from Google) -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <script src="{% static 'js/jquery.bxslider.js' %}"></script>
        <script src="{% static 'js/jquery.cookie.js' %}"></script>
        <link href="{% static 'css/jquery.bxslider.css' %}" rel="stylesheet" />
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
        <link href="{% static 'css/social.css' %}" rel="stylesheet" />
        <link href="{% static 'css/base.css' %}" rel="stylesheet" />


        <script>
            var csrftoken = $.cookie('csrftoken');

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

            function login() {
                if (location.hash != '#login') return;
                $.ajax({
                    url: '/login/json/',
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        if (data.data.authenticated) {
                            return;
                        }
                        $("#cover").html(data.data.content);
                        $('#cover').fadeIn();
                        $('#login button').click(loginSubmit);
                    }
                });
            }
            function logout() {
                if (location.hash != '#logout') return;
                $.ajax({
                    url: '/logout/json/',
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        window.location = window.location.href.split('#')[0];
                    }
                });
            }

            function setupLoginLogout() {
                login();
                logout();
            };

            window.onhashchange = setupLoginLogout;
            setupLoginLogout();

            function loginSubmit(e) {
                e.preventDefault();
                var formData = {
                    username: $('#login input[name=username]').val(),
                    password: $('#login input[name=password]').val(),
                    csrfmiddlewaretoken: $('#login input[name=csrfmiddlewaretoken]').val(),
                };
                $.ajax({
                    url: '/login/json/',
                    type: 'post',
                    dataType: 'json',
                    data: formData,
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        if (data.data) {
                            $("#cover").html(data.data.content);
                            $('#cover').fadeIn();
                            $('#login button').click(loginSubmit);
                            $('ul.errorlist').effect('bounce');
                        } else {
                            window.location = window.location.href.split('#')[0];
                        }

                    }
                });
            }
        </script>

        <style>
            {% comment %}
            {% if user.is_authenticated %}
                .center-column {
                    *border: 1px dashed red;
                    background-color: #fff;
                }
                body {
                    background-color: #fff8f8;
                }
                #header .content {
                    background-color: #fff8f8 !important;
                }
            {% endif %}
            {% endcomment %}
        </style>
        {% block extrastyle %}{% endblock %}
    </head>
    <body>
        {% block site %}
            <div id="body">
                <section id="header" style="">
                    <div id="logo-home">
                        {% block logo %}
                            <img src="{% static 'img/logo-small-bw.png' %}" />
                        {% endblock %}
                    </div>
                    <div class="content">
                        <div class="transp transp-top" style="">
                            {% include "top-menu.html" %}
                        </div>
                    </div>
                </section>
                <div style="height: 100px;"></div>
                <div class="center-column">
                    <section class="container-top">
                        {% block container %}
                        {% endblock %}
                        <div class="clear"></div>
                    </section>
                    <div class="clear"></div>
                </div>
                <div class="site-middle">
                    <div class="center-column">
                        <section class="container-middle">
                            {% block container-middle %}
                            {% endblock %}
                        </section>
                    </div>
                </div>
                <div class="center-column">
                    <section class="container-bottom">
                        {% block container-bottom %}
                        {% endblock %}
                        <div class="clear"></div>
                    </section>
                    <div class="clear"></div>
                </div>

                <div class="clear"></div>
                <div style="height: 20px;"></div>
                <section id="footer">
                    <div class="content">
                        {% with '32' as size %}
                            <div class="footer-social">{% include "social.html" %}</div>
                        {% endwith %}
                        <div class="copyrights">&#9400 Flavia Bernardes, 2015. All rights reserved.</div>
                        <div class="clear"></div>
                    </div>
                </section>
            </div>
        {% endblock %}
    </body>
    <script>
        $(window).ready(function () {
            if ($.browser.chrome) {
                //$("#logo-home").css("margin", "-10px auto 28px auto");
            }
            $(window).scroll(function () {
            return;
                if ($(window).scrollTop() > 110) {
                    $('#header').addClass('menu-fixed');
                } else {
                    $('#header').removeClass('menu-fixed');
                }
            });
            //$('#logo-home').click(function () {
            //    window.location.replace('/');
            //});
        });
    </script>
</html>
