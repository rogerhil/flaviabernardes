{% load staticfiles %}
{% load cropping %}

<html>
    <head>

        <link rel="shortcut icon" href="{% static 'img/favicon.png' %}" />

        <link href="{% static 'css/jquery.bxslider.css' %}" rel="stylesheet" />
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
        <link href="{% static 'css/social.css' %}" rel="stylesheet" />
        <link href="{% static 'css/base.css' %}" rel="stylesheet" />
        <link href="{% static 'css/newsletter.css' %}" rel="stylesheet" />

        <!-- jQuery library (served from Google) -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <script src="{% static 'js/jquery.bxslider.js' %}"></script>
        <script src="{% static 'js/jquery.cookie.js' %}"></script>
        <script src="{% static 'js/parallax.js' %}"></script>
        <script src="{% static 'js/fixatscroll.js' %}"></script>

        <script type="text/javascript">var switchTo5x=true;</script>
        <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
        <script type="text/javascript">stLight.options({publisher: "023fcf4a-4582-470d-8c44-a22303a1ce96", doNotHash: true, doNotCopy: false, hashAddressBar: false});</script>
        {% block extrajs %}{% endblock %}

        <script>
            var csrftoken = $.cookie('csrftoken');

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

            function login() {
                if (location.hash != '#login') return;
                $.ajax({
                    url: '/login/json/',
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        if (data.data.authenticated) {
                            return;
                        }
                        $("#cover").html(data.data.content);
                        $('#cover').fadeIn();
                        $('#login button').click(loginSubmit);
                    }
                });
            }
            function logout() {
                if (location.hash != '#logout') return;
                $.ajax({
                    url: '/logout/json/',
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        window.location = window.location.href.split('#')[0];
                    }
                });
            }

            function setupLoginLogout() {
                login();
                logout();
            };

            window.onhashchange = setupLoginLogout;
            setupLoginLogout();

            function loginSubmit(e) {
                e.preventDefault();
                var formData = {
                    username: $('#login input[name=username]').val(),
                    password: $('#login input[name=password]').val(),
                    csrfmiddlewaretoken: $('#login input[name=csrfmiddlewaretoken]').val(),
                };
                $.ajax({
                    url: '/login/json/',
                    type: 'post',
                    dataType: 'json',
                    data: formData,
                    success: function (data) {
                        if (!data.success) {
                            alert(data.message);
                            return
                        }
                        if (data.data) {
                            $("#cover").html(data.data.content);
                            $('#cover').fadeIn();
                            $('#login button').click(loginSubmit);
                            $('ul.errorlist').effect('bounce');
                        } else {
                            window.location = window.location.href.split('#')[0];
                        }

                    }
                });
            }

        </script>

        <style>
            {% comment %}
            {% if user.is_authenticated %}
                .center-column {
                    *border: 1px dashed red;
                    background-color: #fff;
                }
                body {
                    background-color: #fff8f8;
                }
                #header .content {
                    background-color: #fff8f8 !important;
                }
            {% endif %}
            {% endcomment %}
        </style>
        {% block extrastyle %}{% endblock %}

    </head>
    <body>
        <div id="cover">
            <img src="{% static 'img/ajax-loader.png' %}" class="ajax-loader">
        </div>
        {% block site %}
            <div id="body">
                <section id="header">
                    <div id="logo" {% if landing_page %}style="height: 70px;"{% endif %}>
                        {% block logo %}
                            <img src="{% static 'img/logo-small-bw.png' %}" />
                        {% endblock %}
                    </div>
                    <div>
                        {% if not landing_page %}
                        <div class="transp transp-top">
                            {% include "top-menu.html" %}
                        </div>
                        {% endif %}
                    </div>
                </section>
                <div style="height: 80px;"></div>
                <div class="site-top">

                    {% block container-subtop %}

                    {% endblock %}

                </div>
                <div class="center-column">
                    <section class="container-top">
                        {% block container %}
                        {% endblock %}
                        <div class="clear"></div>
                    </section>
                    <div class="clear"></div>
                </div>
                <div id="site-middle-anchor"></div>
                <div class="site-middle scroll-fixed" fixat="80" anchor="site-middle-anchor">
                    <div class="center-column">
                        {% block container-middle %}
                            <section class="container-middle">
                                <div id="newsletter-wrap">
                                    <p class="center">
                                        {% block newsletter_description %}
                                            Want an exclusive artwork wallpaper? Sign up below
                                        {% endblock %}
                                    </p>
                                    {% include "newsletter/line_form.html"  %}
                                </div>
                                <div class="clear"></div>
                                <script src="{% static 'js/jquery.form.min.js' %}"></script>
                                <script src="{% static 'js/newsletter.js' %}"></script>
                            </section>
                        {% endblock %}
                    </div>
                </div>
                <div class="center-column">
                    <section class="container-bottom">
                        {% include "share.html"  %}
                        <div class="clear"></div>
                        <br><br><br>
                        {% block container-bottom %}
                        {% endblock %}
                        <div class="clear"></div>
                    </section>
                    <div class="clear"></div>
                </div>

                <div class="clear"></div>
                <div style="height: 40px;"></div>
                <div class="clear"></div>
                <section id="footer">
                    <div class="content">
                        {% with '32' as size %}
                            <div class="footer-social">{% include "social.html" %}</div>
                        {% endwith %}
                        <div class="copyrights">&#9400 Flavia Bernardes, 2015. All rights reserved.</div>
                        <div class="clear"></div>
                    </div>
                </section>
            </div>
        {% endblock %}
    </body>
    <script>
        $(window).ready(function () {
            if ($.browser.chrome) {
                //$("#logo-home").css("margin", "-10px auto 28px auto");
            }
            $('#logo img').click(function () {
                window.location.replace('/');
            });
        });
    </script>
</html>
