{% extends 'base.html' %}
{% load staticfiles %}
{% load cropping %}

{% block title %}Flavia Bernardes Art | Artworks{% endblock %}
{% block ogtitle %}Flavia Bernardes Art | Artworks{% endblock %}
{% block ogdescription %}Check out artist Flavia Bernardes' artworks{% endblock %}
{% block ogurl %}{% url 'artworks' %}{% endblock %}
{% if artwork_list %}
    {% block ogimage %}{% cropped_thumbnail artwork_list.0 "listing_preview" scale=1 %}{% endblock %}
{% endif %}

{% block container %}
    <div id="full-view">

    </div>
    <div id="painting-preview">
        {% if artwork_list %}
            <img src="{% cropped_thumbnail artwork_list.0 "listing_preview" scale=1 %}">
        {% endif %}
    </div>
    <div id="thumbnails">
        <ul>
            {% for artwork in artwork_list %}
                <li artwork="{{ artwork.id }}" class="ui-state-default">
                    <div>
                        <p>
                            {{ artwork.name }}<br />
                            {{ artwork.year }}<br /><br />
                            {{ artwork.type }}<br />
                            {{ artwork.width }} X {{ artwork.height }} cm<br />
                        </p>
                    </div>
                    <img src="{% cropped_thumbnail artwork 'thumbnail' scale=1 %}" />
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        var preview_urls = {
            {% for artwork in artwork_list %}
                {{ artwork.id }}: {preview: '{% cropped_thumbnail artwork 'listing_preview' scale=1 %}', original: '{% cropped_thumbnail artwork 'full_preview' width=960 %}'},
            {% endfor%}
        };
        $('#thumbnails li').mouseover(function (e) {
            var url = preview_urls[$(this).attr('artwork')].preview;
            $('#painting-preview img').fadeOut(1000, function () {$(this).remove();});
            var $img = $('<img src="' + url + '" style="display: none;" />');
            $('#painting-preview').append($img);
            $img.fadeIn(500);
            $('<img/>')[0].src = preview_urls[$(this).attr('artwork')].original;
            //$(this).find('p').css('color', '#000');
        });
        $('#thumbnails li').click(function (e) {
            var url = preview_urls[$(this).attr('artwork')].original;
            $("#full-view").append('<img src="' + url + '" />');
            $("#full-view").css('z-index', 9999);
            $("#full-view").fadeIn(1000);
            $('#cover').fadeIn();
        });
        var closeFullPreview = function () {
            $("#full-view").fadeOut(1000, function () {
                $(this).html('');
            });
            $('#cover').fadeOut();
            //$("#footer").fadeIn();
        }
        $('#full-view').click(closeFullPreview);
        $('#cover').click(closeFullPreview);


        $(window).mousemove(function (e) {

            if (e.clientY > 560) {
            //    console.log(e.clientX);
            //    $('#thumbnails').animate({scrollTop: 150}, 500);

            }

        });

        $("#thumbnails ul").sortable({
            stop: function (e, ui) {
                var data = [];
                $("#thumbnails ul li").each(function () {
                    data.push($(this).attr('artwork'));
                });
                console.log(data);
                $.ajax({
                    url: '/artworks/sort/',
                    type: 'POST',
                    dataType: 'json',
                    data: {data: data},
                    success: function (result) {
                        console.log(result);
                        if (!result.success) {
                            alert('Something went wrong while trying to sort the artworks. Please contact Rogerio: ' + result.message);
                        }
                    }
                })
            }
        });
        $("#thumbnails ul").disableSelection();

    </script>
{% endblock %}
