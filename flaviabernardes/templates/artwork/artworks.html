{% extends 'base.html' %}
{% load staticfiles %}
{% load cropping %}

{% block extrastyle %}
    <link href="{% static 'css/blog.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
{% endblock %}

{% block container-large %}
    <div id="full-view">

    </div>
    <div id="artworks">
        {% for artwork in artwork_list %}
            <div class="grid artwork" artwork="{{ artwork.id }}">
                <figure class="effect-lily" style="background-image: url({% cropped_thumbnail artwork 'thumbnail' scale=1 %});">
                    <div class="dark">
                        <figcaption>
                            <div class="description">
                                <h2 class="title">{{ artwork.name }}</h2>
                                <br>
                                <p class="details">
                                    {{ artwork.type }}, {{ artwork.width }}x{{ artwork.height }}cm, {{ artwork.year }}
                                </p>
                            </div>
                            <a href="#">View more</a>
                        </figcaption>
                    </div>
                </figure>
            </div>
        {% endfor %}
    </div>
    <div class="clear"></div>

    <script>
        var preview_urls = {
            {% for artwork in artwork_list %}
                {{ artwork.id }}: {original: '{% cropped_thumbnail artwork 'full_preview' width=960 %}'},
            {% endfor%}
        };
        var $currentOpened;
        $('#artworks div.artwork').click(function (e) {
            var url = preview_urls[$(this).attr('artwork')].original;
            var title = $(this).find('.title').text();
            var details = $(this).find('.details').text();
            $("#full-view").append('<img src="' + url + '" />');
            $("#full-view").append('<div class="artwork-preview-details"><p class="title">' + title + '</p><p>' + details + '</p></div>');
            $("#full-view").append('<div id="close-artwork-preview" class="fa fa-times-circle"></div>');
            $("#full-view").css('z-index', 9990);
            $("#full-view").fadeIn(1000);
            $('#cover img').hide();
            $('#cover').fadeIn();
            $("#footer").fadeOut();
            $(".banner").hide();
            $(".page-content1").hide();
            $(".page-content2").hide();
            $(".page-content3").hide();
            $("#artworks").hide();
            $(".site-middle").hide();
            $(".container-bottom").hide();
            $currentOpened = $(this);

        });
        var closeFullPreview = function () {
            $("#full-view").fadeOut(1000, function () {
                $(this).html('');
            });
            $('#cover').fadeOut();
            $('#cover img').fadeIn(5000);
            $("#footer").fadeIn();
            //$("#artworks").css('visibility', 'visible');
            $("#artworks").fadeIn();
            $(".site-middle").fadeIn();
            $(".container-bottom").fadeIn();
            $(".banner").fadeIn();
            $(".page-content1").show();
            $(".page-content2").show();
            $(".page-content3").show();
        }
        $('#full-view').click(closeFullPreview);
        $('#cover').click(closeFullPreview);
        $(document).keydown(function(e) {
            var $item;
            switch (e.keyCode) {
                case 27:
                    closeFullPreview();
                    break;
                case 37:  // left
                    $item = $currentOpened.prev();
                    if ($item.length) {
                        $("#full-view").html('');
                        $item.trigger('click');
                        $("#full-view img").hide();
                        $("#full-view img").fadeIn();
                    }
                    break;
                case 39:  // right
                    $item = $currentOpened.next();
                    if ($item.length) {
                        $("#full-view").html('');
                        $item.trigger('click');
                        $("#full-view img").hide();
                        $("#full-view img").fadeIn();
                    }
                    break;
            }
        });

        $("#artworks").sortable({
            stop: function (e, ui) {
                var data = [];
                $("#artworks .artwork").each(function () {
                    data.push($(this).attr('artwork'));
                });
                $.ajax({
                    url: '/artworks/sort/',
                    type: 'POST',
                    dataType: 'json',
                    data: {data: data},
                    success: function (result) {
                        console.log(result);
                        if (!result.success) {
                            alert('Something went wrong while trying to sort the artworks. Please contact Rogerio: ' + result.message);
                        }
                    }
                })
            }
        });
        $("#thumbnails ul").disableSelection();

    </script>
{% endblock %}
